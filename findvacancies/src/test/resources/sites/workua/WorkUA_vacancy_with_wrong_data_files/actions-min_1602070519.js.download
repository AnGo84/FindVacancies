$(function(){function t(t){r||f||(r=!0,$.ajax({type:"GET",dataType:"json",data:{beforeId:c,limit:t},url:"/notification/list/",beforeSend:function(){$("#notificationLoad").show()},success:function(i){0==c&&""==i.html&&$("#notificationMessage").show(),1==i.pagination.lastPage&&(f=1),""!=i.html&&(20==t&&(t=10),$(i.html).insertBefore("#notificationLoad"),c=$(".js-notification",e).last().data("id"),h&&$(window).width()>767&&a()),$("#notificationLoad").hide(),$("#notificationCounter").length&&$("#notificationCounter").remove()}}).always(function(){r=!1}))}function i(t){var i=$(window).scrollTop(),o=$("body")[0].style;t?(o.position="fixed",o.width="100%",o.top=-i+"px"):(o.position="",o.width="",$(window).scrollTop(o.top.slice(1,-2)),o.top="")}function o(t){if(!t.length)return!1;var i=t.offset().top+t.height()-$(window).scrollTop(),o=t.find(".dropdown-menu");if(o.attr("style",""),$(window).width()<768)o.css("top",i);else{var n=$(window).height()-i-15;n<900&&o.css("max-height",n)}}function n(){var t=$(".navbar-nav").find(".active");t&&t.toggleClass("disable-active")}function a(){var t=+e.css("min-height").slice(0,-2),i=$(".notice-header").outerHeight(!0),o=$(".js-notification",e),n=t-i,a=0;o.length<3&&(o.each(function(){return!(n-$(this).outerHeight(!0)<=0)&&(a+=$(this).outerHeight(!0),!(n-a<1)&&void 0)}),n-a>0&&o.last().css("border-bottom","1px solid #e9ebed")),h=!1}var e=$("#notificationBox"),s=$("#notificationBox, #notificationsList"),d=$("#dropdownMenu-notifications"),c=0,r=!1,f=0,h=!0;d.on("show.bs.dropdown",function(){t(20),o(d),$(window).width()<768&&(i(!0),n())}),d.on("hide.bs.dropdown",function(){$(window).width()<768&&(i(!1),n())}),e.on("scroll",function(){$(this).scrollTop()/$(this).innerHeight()*100>70&&!r&&!f&&t(10)}),$(window).on("resize",function(){d.hasClass("open")&&($(window).width()<768?i(!0):(i(!1),a())),o(d)}),$(s).on("click",".js-notification",function(){var t=$(this),i=t.data("id");void 0!==i&&"not_read"==t.attr("data-status")&&$.ajax({type:"post",dataType:"json",url:"/notification/"+i+"/read/",success:function(i){i.status&&$(t).attr("data-status","read").find("p:last").removeAttr("style")}})})});