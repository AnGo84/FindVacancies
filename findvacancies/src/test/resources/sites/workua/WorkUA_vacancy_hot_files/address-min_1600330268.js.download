function cityObject(e){var a=null;for(var n in citiesTH){if(citiesTH.hasOwnProperty(n))for(var s in citiesTH[n])if(citiesTH[n].hasOwnProperty(s)&&(citiesTH[n][s]===e||parseInt(citiesTH[n][s])===e)){a=citiesTH[n];break}if(a)break}return a}var mapStaticHost="//st.work.ua",Addresses={AddressMap:function(e){return{hide:function(){e.hide()},show:function(a){this.renderMapWithMarker(a,17),e.show()},renderMapWithMarker:function(a,n){a=window.encodeURIComponent(a.replace("&#039;",""));var s=$("<iframe />",{frameborder:0,style:"border:0",src:"https://www.google.com/maps/embed/v1/place?q="+a+"&zoom="+n+"&key="+window.google_maps_key+"&language="+Work.config.localeConfig.lang[window.lang.locale].languageCode});s.width("100%"),s.height(400),e.empty().append(s)}}},showAddressSelector:function(e,a,n){var s=$(this),t=window.lang.locale,d=a.modal&&a.modal.title||lang.address_modal.title,o=a.modal&&a.modal.subTitle||lang.address_modal.address_selector,r=a.modal&&a.modal.buttonSave||lang.save,i=void 0===a.showRequiredFieldMarker||a.showRequiredFieldMarker;if(e=cityObject(e||""),n=n||function(){},!e)return void n(null);var l='<div id="address-form" class="form-inline-with-button"><label for="search-address">'+o+" "+e[t+"_v1"]+(i?'<span class="text-danger" data-dismiss="modal">*</span>':"")+':</label><div class="form-group form-group-large"><div class="input-holder"><input class="form-control" name="address" id="search-address" placeholder="'+lang.address_modal.address_placeholder+'"></div></div><div class="form-group form-group-short"><button id="search-address-btn" class="btn btn-default">'+lang.address_modal.address_button+"</button></div></div>",c={title:d,own_body_el:l,footer_buttons:[],widthClass:$('[data-spy="affix"]').length>0?"add-top-lg":"",closeFunc:function(){p.close()}},u=void 0===a.ajaxRequestType?"save":a.ajaxRequestType,f=function(e,a){$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:e,success:function(e){e&&e.error?a():a(e)}})},p={init:function(){s.ModalBPWnd("options",c),s.ModalBPWnd("resetContent"),s.ModalBPWnd("setContent")},open:function(){s.ModalBPWnd("open")},close:function(){$("#search-address").val(""),g.reset()},setFooter:function(){c.footer_buttons=[{name:r,type:"button",close_on_click:1,func:function(){var e={};e[u]=g.value(),f(e,n)}},{type:"or-cancel",func:function(){s.ModalBPWnd("close")}}],s.ModalBPWnd("options",c),s.ModalBPWnd("setFooter")},clearFooter:function(){s.ModalBPWnd("cleanFooter")}};s.ModalBPWnd(c),p.init();var g=new Addresses.Address(e,function(e,a){var n={};for(var s in e)n[s]=e[s];for(var s in a)n[s]=a[s];return n}(a.address,{onVariants:function(){p.setFooter()},onReset:function(){p.clearFooter()},errorLinkEvent:function(){$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{query:Addresses.getFullQueryString(Work.dictionary.locale.text[t].cityPrefix,e[t],e["center_"+t]),city:e.ua,cityId:e.id},success:function(e){e&&Array.isArray(e)&&1===e.length&&f({save:e[0]},function(e){n(e),s.ModalBPWnd("close")})}})}}));g.init(),g.tips(),g.events(),g.enable(),p.open()},getFullQueryString:function(e,a,n){return n+", "+e+" "+a},Address:function(e,a){e=e||[],a=a||{};var n,s,t,d,o=a.container||"#address-form",r=a.button||"#search-address-btn",i=a.input||"#search-address",l=a.preload||null,c=a.error&&a.error.content||null,u=a.error&&a.error.input||lang.address_modal.input_error,f=(a.errorLinkEvent,window.lang.locale),p=a.onSearch||function(){},g=a.onAddressChange||function(){},h=a.onVariants||function(){},v=a.onVariantsChange||function(){},m=a.onReset||function(){},_=[],y=[],w=$("<img />",{src:"/static/i/spinner_grey.gif",width:"35",height:"35",class:"block",style:"margin-top: 2px"}),b=function(e){if(!e)return void k.blue();$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{get:e},success:function(e){y=[e]||[],p(y),P(),t.show(Addresses.getFullQueryString(Work.dictionary.locale.text[f].cityPrefix,e.town_name,e.formatted_address))}})},k={blue:function(){$(r).removeClass("btn-supplement").addClass("btn-default")},white:function(){$(r).addClass("btn-supplement").removeClass("btn-default")}},x=!1,A={on:function(){x=!0,O(),d.find("span").hide(),$(i).after(d.append(w)),$(i).val(lang.address_modal.loading)},off:function(){x=!1,R(),w.detach(),d.find("span").removeAttr("style"),$(i).val("")}},S={show:function(a,n){n=n?$("<h2 />").aapend(n):$("<h2 />").append(lang.address_modal.address_not_found),a=a?$("<p />").append(a):c?$("<p />").append(c):$("<p />",{text:lang.address_modal.address_not_found_more.replace("{0}",e[f+"_v1"])+" "}).append($("<a />",{href:"javascript:void(0)",text:lang.address_modal.address_not_found_link}).on("click",function(e){e.preventDefault(),Addresses.setTownCenterGeolocation()})).append("."),$("#address-error").empty().append(n).append(a).show()},hide:function(){$("#address-error").hide()}},C={show:function(){var e=$("<p />",{class:"text-danger",text:u+" "}).append($("<a />",{href:"javascript:void(0)",text:lang.address_modal.here}).on("click",function(e){e.preventDefault(),x||(T(),A.on(),Addresses.autodetectGeolocation(function(e){A.off(),e&&$(i).trigger("input").val(e[0].formatted_address).focus(),e||(T(),S.show(lang.address_modal.geolocation))}))})).append(".");$(i).parent().addClass("has-danger").append(e),n.hide()},hide:function(){$(i).parent().removeClass("has-danger").find("p.text-danger").remove(),n.show()}},j=function(){var e=$("<div />",{id:"address-variants",class:"form-group"}).hide().append($("<label />",{text:lang.address_modal.refinement})).append($("<div />",{id:"address-variants-values",class:"has-indent"})),a=$("<div />",{id:"address-map",class:"map-frame"}).hide(),n=$("<div />",{id:"address-error",class:"alert alert-danger add-top",style:"margin-bottom: 0"}).hide();"geolocation"in navigator&&(d&&d.remove(),d=$("<div />",{class:"icon-stack"}).append($("<a />",{href:"javascript:void(0)",class:"link-geolocation"}).append($("<span />",{class:"glyphicon glyphicon-geolocation"}))),d.off("click").on("click",function(e){e.preventDefault(),x||(T(),A.on(),Addresses.autodetectGeolocation(function(e){A.off(),e&&$(i).trigger("input").val(e[0].formatted_address).focus(),e||(T(),S.show(lang.address_modal.geolocation))}))}),$(i).after(d)),$(o).after(n).after(a).after(e)},T=function(){m(),S.hide(),x=!1,w.detach(),d.find("span").css({}),C.hide(),t.hide(),k.blue(),M()},P=function(){var e=$("#address-variants-values");if(e.empty(),y.length>1){var a=$("#address-variants");a.show();for(var n in y)if(y.hasOwnProperty(n)){var s=$("<input />",{name:"address_variant",type:"radio",value:n}).prop("checked",0===parseInt(n)),d=$("<label />").append(s).append(y[n].formatted_address),o=$("<div />",{class:"radio"}).append(d);e.append($("<div />",{class:"radio"}).append(o))}a.find("input").off("change").on("change",function(){var e=$(this).val();t.show(Addresses.getFullQueryString(Work.dictionary.locale.text[f].cityPrefix,y[e].town_name,y[e].formatted_address)),k.white(),v(y[e])})}h(y)},M=function(){$("#address-variants").hide(),$("#address-variants-values").empty(),y=[]},W=function(e,a,n){var s,t,d,o=null,r=0;n||(n={});var i=function(){r=!1===n.leading?0:Date.now(),o=null,d=e.apply(s,t),o||(s=t=null)};return function(){var l=Date.now();r||!1!==n.leading||(r=l);var c=a-(l-r);return s=this,t=arguments,c<=0||c>a?(o&&(clearTimeout(o),o=null),r=l,d=e.apply(s,t),o||(s=t=null)):o||!1===n.trailing||(o=setTimeout(i,c)),d}},F=function(){t=Addresses.AddressMap($("#address-map")),b(l),$("#search-address").off("input").on("input",function(){g(),T()}).off("keyup").on("keyup",function(e){C.hide(),e.preventDefault(),13===e.keyCode&&$(r).trigger("click")}),$(r).off("click").on("click",W(function(){C.hide();var a=$(i).val().trim(),n=$("#address-variants-values").find("input:checked").val(),s=n||0,d=y[s];return a.length?(!d&&!$("#address-error").is(":visible")||!a)&&(_.push(a),void(x||$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{query:Addresses.getFullQueryString(Work.dictionary.locale.text[f].cityPrefix,e[f],a),city:e[f],cityId:e.id},beforeSend:function(){x=!0,$(r).prop("disabled",!0)},success:function(n){if(n&&n.error)S.show(lang.address_modal.address_not_found_more_v4);else if(y=n||[],p(n),1===n.length)$(i).val(n[0].formatted_address),P(),t.show(Addresses.getFullQueryString(Work.dictionary.locale.text[f].cityPrefix,n[0].town_name,n[0].formatted_address));else if(n.length>1)P(),t.show(Addresses.getFullQueryString(Work.dictionary.locale.text[f].cityPrefix,n[0].town_name,n[0].formatted_address));else{"undefined"==typeof sessionStorage&&(sessionStorage={getItem:function(){},setItem:function(){}});var s=sessionStorage.getItem("address")&&Array.isArray(sessionStorage.getItem("address"))?JSON.parse(sessionStorage.getItem("address"))[0].formatted_address:null;S.hide(),a===s?S.show(lang.address_modal.address_not_found_auto.replace("{0}",e[f+"_v1"])):S.show()}},complete:function(){$(r).prop("disabled",!1),k.white(),x=!1}}))):(C.show(),!1)},1e3))},I=function(){n&&n.detach(),s&&s.detach();var a=$("#search-address-tips");a&&a.remove(),n=$("<div />",{id:"search-address-tips",class:"small text-muted add-top-sm"}),n.append(lang.address_modal.for_example+" "),e["center_"+lang.locale]&&n.append($("<a />",{href:"#",id:"city-center-address",class:"border-dashed-grey",text:e["center_"+lang.locale]})).append(", "),"geolocation"in navigator&&(n.append($("<a />",{id:"here",href:"#",class:"border-dashed-grey",text:lang.address_modal.here})),n.find("#here").off("click").on("click",function(e){e.preventDefault(),x||(T(),A.on(),Addresses.autodetectGeolocation(function(e){A.off(),e&&$(i).trigger("input").val(e[0].formatted_address).focus(),e||(T(),S.show(lang.address_modal.geolocation))}))})),n.find("a:not(#here)").off("click").on("click",function(e){e.preventDefault(),$(i).trigger("input").val($(this).text()).focus()}),s=$("<div />",{class:"small text-muted add-top-sm"}),s.append(lang.address_modal.for_example+" "),"geolocation"in navigator&&s.append($("<span />",{text:lang.address_modal.here})),s&&$(i).parent().after(s)},O=function(){$(i).val(""),$(i).prop("disabled",!0).addClass("disabled"),$(r).prop("disabled",!0).addClass("disabled"),$(i).parents('[class^="form-inline"]').addClass("disabled"),"geolocation"in navigator&&d&&d.detach(),n&&n.detach(),s&&$(i).parent().after(s)},R=function(){$(i).prop("disabled",!1).removeClass("disabled"),$(r).prop("disabled",!1).removeClass("disabled"),$(i).parents('[class^="form-inline"]').removeClass("disabled"),"geolocation"in navigator&&$(i).after(d),s&&s.detach(),n&&$(i).parent().after(n)};return{init:function(){j()},tips:I,events:F,reset:function(){T()},error:{hide:S.hide,show:S.show},changeLocation:function(a){e=a,I(),T()},disable:O,enable:R,value:function(){var e=$("#address-variants-values").find("input:checked").val(),a=e||0,n=y[a];if(n)return n.query_string=JSON.stringify(_),n}}},beforeRedirectCallback:function(e,a){},setBeforeRedirectCallback:function(e){this.beforeRedirectCallback=e},showPopupWithChoosingAddress:function(e){this.$changeAddressLink=$(e),this.$changeAddressLink.closest("div.popover").remove();var a=this.$changeAddressLink.data("config-city"),n=this.$changeAddressLink.attr("href");Addresses.showAddressSelector(a,{ajaxRequestType:"changeAddress",address:{error:{input:lang.address_modal.input_error_v2}},showRequiredFieldMarker:!1},function(e){Addresses.beforeRedirectCallback(Addresses.$changeAddressLink,e),window.location.href=n})},setTownCenterGeolocation:function(){var e=this.$changeAddressLink?this.$changeAddressLink.attr("href"):"",a=this.$changeAddressLink.data("config-city");$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{setTownCenterGeolocation:a},success:function(a){window.location.href=e}})},autodetectGeolocation:function(e){if(e=e||function(){},"geolocation"in navigator){"undefined"==typeof sessionStorage&&(sessionStorage={getItem:function(){},setItem:function(){}});var a=sessionStorage.getItem("address");a&&"0"!==a?e(JSON.parse(a)):navigator.geolocation.getCurrentPosition(function(a){var n=a.coords.latitude,s=a.coords.longitude;$.ajax({type:"POST",url:"/_data/_ajax/addresses.php",cache:!1,dataType:"json",data:{query:[n,s]},success:function(a){sessionStorage.setItem("address",JSON.stringify(a)),e(a)}})},function(){sessionStorage.setItem("address","0"),e()},{maximumAge:15e3})}else e()},initToggleMap:function(e,a,n){var s=$(e);s.toggleHiddenBlock(),s.click(function(){void 0===window.jobAddressMap&&(jobAddressMap=Addresses.AddressMap($(a)),jobAddressMap.renderMapWithMarker(n.address,n.zoom))})}};